from django.shortcuts import render
from ldap3 import Server, Connection, SUBTREE
from django.contrib.auth.decorators import login_required
from pyad import aduser
from pyad import pyadutils
import pythoncom
from tkinter import *
from tkinter import ttk
import tkinter.font as font
import pyad.aduser
import pyad.adquery
import pyperclip

from pyad import aduser
from pyad import pyadutils



def search_users_in_ad(starting_string):
    #try:
    starting_string = 'GROSSI Hermanno'
    print(starting_string)
    user = aduser.ADUser.from_cn(starting_string)
    print(user)

    # #except Exception:
    #
    #     return None

    # for row in q.get_results():
    #     users.append(aduser.ADUser.from_cn(row["cn"]))
    return user


#@login_required
def search_users(request):

    if request.method == 'POST':
        search_string = request.POST.get('search_string')
        print(search_string)
        results = search_users_in_ad(search_string)
        print(results)

         # #server = Server('ldap://radiofrance.com')
         # with Connection(server, user=request.user.email, password=request.user.ldap_password, auto_bind=True) as conn:
         #    conn.search('OU=users,DC=example,DC=com', '(&(objectClass=user)(sAMAccountName={0}*))'.format(search_string), SUBTREE, attributes=['sAMAccountName', 'mail'])
         #    results = conn.entries
         #    users = []
         #    for result in results:
         #        user = {
         #            'username': result.sAMAccountName.value,
         #            #'email': result.mail.value,
         #            #'ad_account': result.entry_dn
         #        }
         #        users.append(user)
         #        context = {'users': users}
         #    return render(request, 'search_results.html', context)
    return render(request, 'search_form.html')
