from django.http import HttpResponse
from django.shortcuts import render
from pyad import adquery
import django.http

def test(request):
    
    if request.method == 'POST':
        print('post')
    else:
        return HttpResponse("Here's the text of the web page.")

def rechercher_utilisateur(request):
    
    if request.method == 'POST':
        nom_utilisateur = request.POST["nom_utilisateur"]
        q = adquery.ADQuery()
        q.execute_query(
            attributes=['displayName', 'mail'],
            where_clause='sAMAccountName=\'{}\''.format(nom_utilisateur)
        )

        utilisateur = q.get_single_result()
        if utilisateur is not None:
            nom_complet = utilisateur['displayName']
            email = utilisateur['mail']
            context = {
                'nom_utilisateur': nom_utilisateur,
                'nom_complet': nom_complet,
                'email': email,
            }
        else:
            print('')
        return render(request, 'resultat_recherche.html', context)

    else:
        #
        # q = adquery.ADQuery()
        # q.execute_query(
        #     attributes=['displayName', 'mail'],
        #     where_clause='sAMAccountName=\'{}\''.format(nom_utilisateur)
        # )
        context = {
            #'nom_utilisateur': nom_utilisateur,
            'erreur': 'Utilisateur non trouv√©',
        }

        return render(request, 'recherche_utilisateur.html', context)
